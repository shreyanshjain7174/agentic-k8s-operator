============================= test session starts ==============================
platform darwin -- Python 3.14.3, pytest-9.0.2, pluggy-1.6.0 -- /Users/sunny/.openclaw/workspace/agentic-k8s-operator/venv/bin/python3.14
cachedir: .pytest_cache
rootdir: /Users/sunny/.openclaw/workspace/agentic-k8s-operator
collecting ... collected 30 items

agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_openai_api_key FAILED [  3%]
agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_github_token FAILED [  6%]
agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_aws_access_key FAILED [ 10%]
agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_jwt_token PASSED [ 13%]
agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_slack_token FAILED [ 16%]
agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_api_key_in_json PASSED [ 20%]
agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_password_field PASSED [ 23%]
agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_bearer_token FAILED [ 26%]
agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_preserves_non_sensitive_text PASSED [ 30%]
agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_uuid PASSED [ 33%]
agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_with_additional_patterns PASSED [ 36%]
agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_handles_empty_string PASSED [ 40%]
agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_handles_none PASSED [ 43%]
agents/tests/test_credential_sanitizer.py::TestSanitizeDict::test_masks_api_key_in_dict PASSED [ 46%]
agents/tests/test_credential_sanitizer.py::TestSanitizeDict::test_masks_nested_dict PASSED [ 50%]
agents/tests/test_credential_sanitizer.py::TestSanitizeDict::test_masks_list_of_dicts PASSED [ 53%]
agents/tests/test_credential_sanitizer.py::TestSanitizeDict::test_preserves_non_sensitive_keys PASSED [ 56%]
agents/tests/test_credential_sanitizer.py::TestSanitizeDict::test_handles_none_values PASSED [ 60%]
agents/tests/test_credential_sanitizer.py::TestSanitizeDict::test_custom_sensitive_keys PASSED [ 63%]
agents/tests/test_credential_sanitizer.py::TestSanitizeDict::test_case_insensitive_key_matching PASSED [ 66%]
agents/tests/test_credential_sanitizer.py::TestSanitizingLogFilter::test_filter_masks_credentials PASSED [ 70%]
agents/tests/test_credential_sanitizer.py::TestSanitizingLogFilter::test_filter_preserves_non_sensitive PASSED [ 73%]
agents/tests/test_credential_sanitizer.py::TestSanitizingLogFilter::test_filter_with_args PASSED [ 76%]
agents/tests/test_credential_sanitizer.py::TestSanitizingFormatter::test_format_masks_credentials FAILED [ 80%]
agents/tests/test_credential_sanitizer.py::TestSetupSanitizingLogger::test_creates_logger_with_sanitization PASSED [ 83%]
agents/tests/test_credential_sanitizer.py::TestSetupSanitizingLogger::test_logger_masks_credentials PASSED [ 86%]
agents/tests/test_credential_sanitizer.py::TestIntegrationScenarios::test_litellm_client_log_simulation PASSED [ 90%]
agents/tests/test_credential_sanitizer.py::TestIntegrationScenarios::test_database_connection_log FAILED [ 93%]
agents/tests/test_credential_sanitizer.py::TestIntegrationScenarios::test_authorization_header_log FAILED [ 96%]
agents/tests/test_credential_sanitizer.py::TestIntegrationScenarios::test_multiple_secrets_in_message FAILED [100%]

=================================== FAILURES ===================================
______________ TestSanitizeCredentials.test_masks_openai_api_key _______________

self = <agents.tests.test_credential_sanitizer.TestSanitizeCredentials object at 0x106b5bd90>

    def test_masks_openai_api_key(self):
        """Test masking of OpenAI API keys."""
        message = "API call failed with key sk-1234567890abcdefghijklmnop"
        result = sanitize_credentials(message)
>       assert "sk-" in result
E       AssertionError: assert 'sk-' in 'API call failed with key ***MASKED***'

agents/tests/test_credential_sanitizer.py:26: AssertionError
_______________ TestSanitizeCredentials.test_masks_github_token ________________

self = <agents.tests.test_credential_sanitizer.TestSanitizeCredentials object at 0x106ab0cd0>

    def test_masks_github_token(self):
        """Test masking of GitHub tokens."""
        message = "GitHub token: ghp_abcdefghijklmnopqrstuvwxyz1234567890"
        result = sanitize_credentials(message)
>       assert "ghp_" in result
E       AssertionError: assert 'ghp_' in 'GitHub token: ***MASKED***'

agents/tests/test_credential_sanitizer.py:34: AssertionError
______________ TestSanitizeCredentials.test_masks_aws_access_key _______________

self = <agents.tests.test_credential_sanitizer.TestSanitizeCredentials object at 0x106b27230>

    def test_masks_aws_access_key(self):
        """Test masking of AWS access keys."""
        message = "AWS credentials: AKIAIOSFODNN7EXAMPLE"
        result = sanitize_credentials(message)
>       assert "AKIA" in result
E       AssertionError: assert 'AKIA' in 'AWS credentials: ***MASKED***'

agents/tests/test_credential_sanitizer.py:42: AssertionError
________________ TestSanitizeCredentials.test_masks_slack_token ________________

self = <agents.tests.test_credential_sanitizer.TestSanitizeCredentials object at 0x106b6fd10>

    def test_masks_slack_token(self):
        """Test masking of Slack tokens."""
        message = "Slack token: xoxb-1234567890123-1234567890123-AbCdEfGhIjKlMnOpQrStUvWx"
        result = sanitize_credentials(message)
>       assert "xoxb-" in result
E       AssertionError: assert 'xoxb-' in 'Slack token: ***MASKED***'

agents/tests/test_credential_sanitizer.py:57: AssertionError
_______________ TestSanitizeCredentials.test_masks_bearer_token ________________

self = <agents.tests.test_credential_sanitizer.TestSanitizeCredentials object at 0x106b16950>

    def test_masks_bearer_token(self):
        """Test masking of bearer tokens."""
        message = "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.abc.def"
        result = sanitize_credentials(message)
>       assert "***MASKED***" in result
E       AssertionError: assert '***MASKED***' in 'Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.abc.def'

agents/tests/test_credential_sanitizer.py:78: AssertionError
____________ TestSanitizingFormatter.test_format_masks_credentials _____________

self = <agents.tests.test_credential_sanitizer.TestSanitizingFormatter object at 0x106ab16d0>

    def test_format_masks_credentials(self):
        """Test that formatter masks credentials."""
        formatter = SanitizingFormatter("%(message)s")
    
        record = logging.LogRecord(
            name="test",
            level=logging.INFO,
            pathname="test.py",
            lineno=1,
            msg="Token: ghp_abcdefghijklmnopqrstuvwxyz1234567890",
            args=(),
            exc_info=None
        )
    
        result = formatter.format(record)
        assert "***MASKED***" in result
>       assert "ghp_" in result
E       AssertionError: assert 'ghp_' in 'Token: ***MASKED***'

agents/tests/test_credential_sanitizer.py:272: AssertionError
____________ TestIntegrationScenarios.test_database_connection_log _____________

self = <agents.tests.test_credential_sanitizer.TestIntegrationScenarios object at 0x106ab1bd0>

    def test_database_connection_log(self):
        """Test database connection string sanitization."""
        message = "Connected to postgres://user:password123@db.example.com:5432/mydb"
        result = sanitize_credentials(message)
>       assert "***MASKED***" in result
E       AssertionError: assert '***MASKED***' in 'Connected to postgres://user:password123@db.example.com:5432/mydb'

agents/tests/test_credential_sanitizer.py:327: AssertionError
____________ TestIntegrationScenarios.test_authorization_header_log ____________

self = <agents.tests.test_credential_sanitizer.TestIntegrationScenarios object at 0x106ef0050>

    def test_authorization_header_log(self):
        """Test Authorization header sanitization."""
        message = "Request headers: {'Authorization': 'Bearer eyJhbGciOiJIUzI1NiJ9.abc.def'}"
        result = sanitize_credentials(message)
>       assert "***MASKED***" in result
E       assert '***MASKED***' in "Request headers: {'Authorization': 'Bearer eyJhbGciOiJIUzI1NiJ9.abc.def'}"

agents/tests/test_credential_sanitizer.py:334: AssertionError
__________ TestIntegrationScenarios.test_multiple_secrets_in_message ___________

self = <agents.tests.test_credential_sanitizer.TestIntegrationScenarios object at 0x106ef0180>

    def test_multiple_secrets_in_message(self):
        """Test masking of multiple secrets in one message."""
        message = "Keys: sk-key1, ghp_token, AKIA1234567890123ABC"
        result = sanitize_credentials(message)
    
        masked_count = result.count("***MASKED***")
>       assert masked_count >= 3
E       assert 1 >= 3

agents/tests/test_credential_sanitizer.py:343: AssertionError
=========================== short test summary info ============================
FAILED agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_openai_api_key
FAILED agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_github_token
FAILED agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_aws_access_key
FAILED agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_slack_token
FAILED agents/tests/test_credential_sanitizer.py::TestSanitizeCredentials::test_masks_bearer_token
FAILED agents/tests/test_credential_sanitizer.py::TestSanitizingFormatter::test_format_masks_credentials
FAILED agents/tests/test_credential_sanitizer.py::TestIntegrationScenarios::test_database_connection_log
FAILED agents/tests/test_credential_sanitizer.py::TestIntegrationScenarios::test_authorization_header_log
FAILED agents/tests/test_credential_sanitizer.py::TestIntegrationScenarios::test_multiple_secrets_in_message
========================= 9 failed, 21 passed in 0.05s =========================
